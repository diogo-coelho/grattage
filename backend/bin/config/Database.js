"use strict";var __awaiter=this&&this.__awaiter||function(e,s,d,c){return new(d=d||Promise)(function(o,t){function a(e){try{r(c.next(e))}catch(e){t(e)}}function n(e){try{r(c.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?o(e.value):((t=e.value)instanceof d?t:new d(function(e){e(t)})).then(a,n)}r((c=c.apply(e,s||[])).next())})},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),require("dotenv/config");const fs_1=__importDefault(require("fs")),path_1=__importDefault(require("path")),mongoose_1=__importDefault(require("mongoose")),FormattedDate_1=__importDefault(require("../utils/FormattedDate"));class Database{constructor(){this._database=mongoose_1.default.connect(process.env.MONGO_DB_URL+"/"+process.env.MONGO_DB_DATABASE)}get database(){return this._database}connect(){return __awaiter(this,void 0,void 0,function*(){this._database.then(e=>{e.connection.on("connected",()=>{console.error(`[ ${FormattedDate_1.default.formattedDate} ] : Conexão estabelecida com sucesso`),fs_1.default.appendFileSync(path_1.default.join(__dirname,"../../logs/server.log"),`[ ${FormattedDate_1.default.formattedDate} ] : Conexão estabelecida com sucesso \r
`)})}),this._database.then(e=>{e.connection.on("disconnected",()=>{console.error(`[ ${FormattedDate_1.default.formattedDate} ] : Conexão desconectada`),fs_1.default.appendFileSync(path_1.default.join(__dirname,"../../logs/server.log"),`[ ${FormattedDate_1.default.formattedDate} ] : Conexão desconectada \r
`)})}),this._database.then(e=>{e.connection.on("error",()=>{console.error(`[ ${FormattedDate_1.default.formattedDate} ] : Erro de conexão`),fs_1.default.appendFileSync(path_1.default.join(__dirname,"../../logs/error.log"),`[ ${FormattedDate_1.default.formattedDate} ] : Erro de conexão \r
`)})})})}closeConnection(){process.on("SIGINT",()=>{this._database.then(e=>{e.connection.close(()=>{console.error(`[ ${FormattedDate_1.default.formattedDate} ] : Mongoose encerrado`),fs_1.default.appendFileSync(path_1.default.join(__dirname,"../../logs/server.log"),`[ ${FormattedDate_1.default.formattedDate} ] : Mongoose encerrado \r
`),process.exit(0)})})})}}exports.default=new Database;